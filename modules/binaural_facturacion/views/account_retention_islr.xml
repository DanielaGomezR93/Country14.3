<odoo>
    <data>


        <!--
        =====================================================
        Retention
        =====================================================
        -->

        <!-- View: Form: Retenciones client-->
        <record id="view_retention_islr_client_form" model="ir.ui.view">
            <field name="name">Formulario de retenciones de islr clientes</field>
            <field name="model">account.retention</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Retention">
                    <header>
	                    <button name="action_draft" type="object" states="cancel" string="Convertir a Borrador" />
                        <button name="action_emitted" type="object" states="draft" string="Validar" class="oe_highlight"/>
                        <button name="action_cancel" type="object" states="emitted" string="Anular" confirm="¿Esta seguro que quiere anular este comprabante? Se revertiran los asientos contables asociados" />
                        <button name="retention_currency_system" attrs="{'invisible':[('actual_currency_retention','=',False)]}" groups="binaural_facturacion.group_multi_currency_retention" type="object" string="Mostrar en moneda del sistema"/>
                        <button name="retention_foreign_currency" attrs="{'invisible':[('actual_currency_retention','=',True)]}" groups="binaural_facturacion.group_multi_currency_retention" type="object" string="Mostrar en moneda alterna"/>
                        <field name="state" widget="statusbar" nolabel="1"/>
                    </header>
                    <group colspan="4" col="4">
                        <field name="foreign_currency_id" invisible="1"/>
                        <field name="multi_currency_retention" invisible="1"/>
                        <field name="actual_currency_retention" invisible="1"/>
                        <field name="type" force_save="1" select="2"/>
                        <field name="type_retention" force_save="1" select="2" invisible="1"/>
                        <field name="partner_id" on_change="onchange_partner_id(type,partner_id)" select="1"  attrs="{'invisible':[('type','=', False)],'readonly':[('state','in',['emitted','cancel'])]}"/>
                        <field name="date_accounting" select="1" attrs="{'readonly':[('state','in',['emitted','cancel'])]}"/>
                        <field name="number" force_save="1" attrs="{'readonly':['|',('type','=', 'in_invoice'),('state','in', ['emitted','cancel'])] }" />
                        <field name="correlative" force_save="1" invisible="1" attrs="{'readonly':[('type','=', 'in_invoice')], 'required':[('type','=', 'out_invoice')] }"/>
                        <field name="date" attrs="{'readonly':[('state','in',['emitted','cancel'])]}"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Linea de Retención">
                            <field colspan="4" name="retention_line" nolabel="1" attrs="{'invisible':[('partner_id','=',False)],'readonly':[('state','in',['emitted','cancel'])]}">
                                <tree editable='bottom'>
                                    <field name="name" readonly="1"/>
                                    <field name="invoice_id" domain="[('apply_retention_islr', '=', False), ('move_type', 'in', ['in_invoice','in_refund']), ('state', 'in', ['posted'])]"
                                           force_save="1" attrs="{'readonly':['|',('parent.type_retention', '=', 'iva'),'&amp;', ('parent.type_retention', '=', 'islr'),('parent.type', '=', 'out_invoice')]}"/>
                                    <field name="retention_id" invisible="1" />
                                    <field name="invoice_type" force_save="1" readonly="1"/>
                                    <field name="payment_concept_id" force_save="1" attrs="{'column_invisible':['|',('parent.type_retention', '=', 'iva'),'&amp;', ('parent.type_retention', '=', 'islr'),('parent.type', '=', 'out_invoice')]}"/>


	                                <field name="facture_total" readonly="1" force_save="1" attrs="{'column_invisible':['|', ('parent.multi_currency_retention','=', False), '&amp;' , ('parent.multi_currency_retention','=', True), ('parent.actual_currency_retention','=', True)]}" widget="monetary" options="{'currency_field': 'company_currency_id'}"/>
                                    <field name="facture_amount" force_save="1" attrs="{'column_invisible':['|', ('parent.multi_currency_retention','=', False), '&amp;' , ('parent.multi_currency_retention','=', True), ('parent.actual_currency_retention','=', True)], 'readonly':['|',('parent.type_retention', '=', 'iva'), '|',  '&amp;',('parent.type_retention', '=', 'islr'), '&amp;',('parent.type', '=', 'in_invoice'),('payment_concept_id', '=', False), '&amp;', ('parent.type_retention', '=', 'islr'), ('parent.type', '=', 'out_invoice')]}" widget="monetary" options="{'currency_field': 'company_currency_id'}"/>
                                    <field name="payment_concept_id" force_save="1" attrs="{'column_invisible':['|',('parent.type_retention', '=', 'iva'),'&amp;', ('parent.type_retention', '=', 'islr'),('parent.type', '=', 'out_invoice')]}"/>

	                                <field name="tax_line" readonly="1" force_save="1" attrs="{'column_invisible':[('parent.type_retention', '=', 'islr')]}"/>
                                    <field name="iva_amount" readonly="1" force_save="1" attrs="{'column_invisible':['|', ('parent.multi_currency_retention','=', False), '&amp;' , ('parent.multi_currency_retention','=', True), ('parent.actual_currency_retention','=', True)]}" widget="monetary" options="{'currency_field': 'company_currency_id'}" />

	                                <field name="related_pay_from" force_save="1" attrs="{'column_invisible':['|',('parent.type_retention', '=', 'iva'),'&amp;', ('parent.type_retention', '=', 'islr'),('parent.type', '=', 'out_invoice')]}"/>
	                                <field name="related_percentage_tax_base" force_save="1" attrs="{'column_invisible':['|',('parent.type_retention', '=', 'iva'),'&amp;', ('parent.type_retention', '=', 'islr'),('parent.type', '=', 'out_invoice')]}"/>
	                                <field name="related_percentage_tariffs" force_save="1" attrs="{'column_invisible':['|',('parent.type_retention', '=', 'iva'),'&amp;', ('parent.type_retention', '=', 'islr'),('parent.type', '=', 'out_invoice')]}"/>
	                                <field name="related_amount_sustract_tariffs" force_save="1" attrs="{'column_invisible':['|',('parent.type_retention', '=', 'iva'),'&amp;', ('parent.type_retention', '=', 'islr'),('parent.type', '=', 'out_invoice')]}"/>

	                                <field name="porcentage_retention" readonly="1" force_save="1" attrs="{'column_invisible':['|',('parent.type_retention', '=', 'islr'),'&amp;', ('parent.type_retention', '=', 'iva'),('parent.type', '=', 'out_invoice')]}"/>
	                                <field name="retention_amount" force_save="1" attrs="{'column_invisible':['|', ('parent.multi_currency_retention','=', False), '&amp;' , ('parent.multi_currency_retention','=', True), ('parent.actual_currency_retention','=', True)], 'readonly': [('parent.type_retention', '=', 'iva')]}" widget="monetary" options="{'currency_field': 'company_currency_id'}" />

                                    <field name="currency_id" invisible="1"/>
                                    <field name="company_currency_id" invisible="1" />
                                    <field name="company_id" invisible="1" />
                                    <field name="is_retention_client" invisible="1"/>

	                                <field name="foreign_currency_rate" force_save="1" readonly="1" attrs="{'column_invisible':[('parent.multi_currency_retention','=', True), ('parent.actual_currency_retention','=', False)]}"/>
	                                <field name="foreign_facture_amount" force_save="1" attrs="{'readonly': [('parent.type_retention', '=', 'iva')], 'column_invisible':[('parent.multi_currency_retention','=', True), ('parent.actual_currency_retention','=', False)]}"/>
	                                <field name="foreign_facture_total" force_save="1" readonly="1" attrs="{'column_invisible':[('parent.multi_currency_retention','=', True), ('parent.actual_currency_retention','=', False)]}"/>
	                                <field name="foreign_iva_amount" force_save="1" readonly="1" attrs="{'column_invisible':[('parent.multi_currency_retention','=', True), ('parent.actual_currency_retention','=', False)]}"/>
	                                <field name="foreign_retention_amount" force_save="1" attrs="{'readonly': [('parent.type', '=', 'in_invoice')], 'column_invisible':[('parent.multi_currency_retention','=', True), ('parent.actual_currency_retention','=', False)]}"/>

                                </tree>
                            </field>

                            <group col="2" colspan="2">
                                <!--field name="amount_base_ret" attrs="{'invisible':[('type','in',[False,'out_invoice','out_refund','out_debit']) ]}" />
                                <field name="amount_total_facture" attrs="{'invisible':[('type','in',[False,'in_invoice','in_refund','in_debit']) ]}" widget="monetary" options="{'currency_field': 'company_currency_id'}" /-->
                                <field name="amount_total_facture" attrs="{'invisible':['|', ('multi_currency_retention','=', False), '&amp;' , ('multi_currency_retention','=', True), ('actual_currency_retention','=', True)]}" widget="monetary" options="{'currency_field': 'company_currency_id'}" />
                                <field name="amount_imp_ret" attrs="{'invisible':['|', ('multi_currency_retention','=', False), '&amp;' , ('multi_currency_retention','=', True), ('actual_currency_retention','=', True)]}" widget="monetary" options="{'currency_field': 'company_currency_id'}"  />
                                <field name="total_tax_ret" attrs="{'invisible':['|', ('multi_currency_retention','=', False), '&amp;' , ('multi_currency_retention','=', True), ('actual_currency_retention','=', True)]}" widget="monetary" options="{'currency_field': 'company_currency_id'}"/>

	                            <field name="foreign_amount_total_facture" attrs="{'invisible':[('multi_currency_retention','=', True), ('actual_currency_retention','=', False)]}" widget="monetary" options="{'currency_field': 'foreign_currency_id'}" />
                                <field name="foreign_amount_imp_ret" attrs="{'invisible':[('multi_currency_retention','=', True), ('actual_currency_retention','=', False)]}" widget="monetary" options="{'currency_field': 'foreign_currency_id'}"  />
                                <field name="foreign_total_tax_ret" attrs="{'invisible':[('multi_currency_retention','=', True), ('actual_currency_retention','=', False)]}" widget="monetary" options="{'currency_field': 'foreign_currency_id'}"/>
                            </group>
                        </page>
                        <page string="Otra Información">
                            <group>
                                <field name="company_id"/>
                                <field name="company_currency_id" readonly="0" />
                            </group>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <!--Configuracion de Vista: Retenciones ISLR Cliente-->
        <record id="action_retention_islr_client"  model="ir.actions.act_window">
            <field name="name">Retenciones ISLR Clientes</field>
            <field name="res_model">account.retention</field>
            <field name="binding_view_types">list</field>
	        <field name="view_mode">tree,form</field>
            <!--field name="search_view_id" ref="view_search_retention_iva"/-->
            <field name="context">{"default_type":'out_invoice', "default_type_retention":'islr'}</field>
	        <field name="domain">[('type_retention', '=', 'islr'), ('type', '=', 'out_invoice')]</field>
        </record>

	    <!--Configuracion de Vista: Retenciones ISLR Proveedor-->
        <record id="action_retention_islr_supplier"  model="ir.actions.act_window">
            <field name="name">Retenciones ISLR Proveedor</field>
            <field name="res_model">account.retention</field>
            <field name="binding_view_types">list</field>
	        <field name="view_mode">tree,form</field>
            <!--field name="search_view_id" ref="view_search_retention_iva"/-->
            <field name="context">{"default_type":'in_invoice', "default_type_retention":'islr'}</field>
	        <field name="domain">[('type_retention', '=', 'islr'), ('type', '=', 'in_invoice')]</field>
        </record>

        <!--Menu Lateral: Retenciones-->
        <menuitem name="Retenciones ISLR" id="menu_retention_islr" sequence="4" parent="account_accountant.menu_accounting"/>

        <menuitem name="Cliente" id="menu_retention_islr_client" sequence="0" parent="menu_retention_islr" action="action_retention_islr_client"/>

	    <menuitem name="Proveedor" id="menu_retention_islr_supplier" sequence="0" parent="menu_retention_islr" action="action_retention_islr_supplier"/>


    </data>
</odoo>